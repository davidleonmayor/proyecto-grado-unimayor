generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Person {
  idPersona          String   @id
  carnet             String?
  nombres            String
  apellidos          String
  tipoDocIdentidad   String
  numDocIdentidad    String   @unique
  emailInstitucional String   @unique
  telefono           String?
  tipoVinculacion    String // Estudiante/Docente/Externo
  fechaRegistro      DateTime @default(now())

  estudianteProgramas StudentProgram[]
  actores             Actor[]
  seguimientos        FollowUp[]
}

model Faculty {
  id             Int    @id @default(autoincrement())
  nombreFacultad String
  codigoFacultad String @unique

  programas AcademicProgram[]
}

model AcademicProgram {
  id             Int    @id @default(autoincrement())
  nombrePrograma String
  codigoSnies    String @unique
  estado         String
  idFacultad     Int

  facultad    Faculty          @relation(fields: [idFacultad], references: [id])
  niveles     ProgramLevel[]
  estudiantes StudentProgram[]
}

model TrainingLevel {
  id          Int     @id @default(autoincrement())
  nombreNivel String
  descripcion String?

  programas ProgramLevel[]
}

model ProgramLevel {
  id               Int    @id @default(autoincrement())
  idPrograma       Int
  idNivelFormacion Int
  estado           String

  programa AcademicProgram @relation(fields: [idPrograma], references: [id])
  nivel    TrainingLevel   @relation(fields: [idNivelFormacion], references: [id])
  opciones DegreeOption[]
}

model DegreeOption {
  id                Int     @id @default(autoincrement())
  nombreOpcion      String
  descripcionOpcion String?
  estado            String
  idProgramaNivel   Int

  programaNivel ProgramLevel @relation(fields: [idProgramaNivel], references: [id])
  trabajos      Thesis[]
}

model StudentProgram {
  carnet          String
  idPrograma      Int
  estadoAcademico String
  fechaIngreso    DateTime
  fechaEgreso     DateTime?

  persona  Person          @relation(fields: [carnet], references: [idPersona])
  programa AcademicProgram @relation(fields: [idPrograma], references: [id])

  @@id([carnet, idPrograma])
}

model Thesis {
  id               Int       @id @default(autoincrement())
  titulo           String
  idOpcionGrado    Int
  idEstadoActual   Int
  fechaRegistro    DateTime  @default(now())
  fechaFinEstimada DateTime?
  resumen          String?   @db.Text

  opcion       DegreeOption @relation(fields: [idOpcionGrado], references: [id])
  estado       ThesisStatus @relation(fields: [idEstadoActual], references: [id])
  actores      Actor[]
  seguimientos FollowUp[]
  practicas    Internship[]
}

model RoleType {
  id          Int     @id @default(autoincrement())
  nombreRol   String
  descripcion String?

  actores Actor[]
}

model Actor {
  id              Int       @id @default(autoincrement())
  idPersona       String
  idTrabajoGrado  Int
  idTipoRol       Int
  fechaAsignacion DateTime
  fechaRetiro     DateTime?
  estado          String
  observaciones   String?

  persona Person   @relation(fields: [idPersona], references: [idPersona])
  trabajo Thesis   @relation(fields: [idTrabajoGrado], references: [id])
  rol     RoleType @relation(fields: [idTipoRol], references: [id])
}

model ThesisStatus {
  id           Int     @id @default(autoincrement())
  nombreEstado String
  descripcion  String?
  orden        Int

  trabajos        Thesis[]
  seguimientosAnt FollowUp[] @relation("EstadoAnterior")
  seguimientosNvo FollowUp[] @relation("EstadoNuevo")
}

model FollowUp {
  id                Int       @id @default(autoincrement())
  idTrabajoGrado    Int
  idActor           String
  idEstadoAnterior  Int?
  fechaRegistro     DateTime  @default(now())
  tipoAccion        String
  descripcion       String?
  idEstadoNuevo     Int?
  concepto          String?
  fechaSustentacion DateTime?
  lugar             String?
  calificacionFinal Int?
  distincion        String?
  numeroResolucion  String?
  fechaResolucion   DateTime?
  numeroOficio      String?
  fechaOficio       DateTime?
  nombreDocumento   String?
  tipoDocumento     String?
  archivo           Bytes?
  rutaArchivo       String?

  trabajo        Thesis        @relation(fields: [idTrabajoGrado], references: [id])
  actor          Person        @relation(fields: [idActor], references: [idPersona])
  estadoAnterior ThesisStatus? @relation("EstadoAnterior", fields: [idEstadoAnterior], references: [id])
  estadoNuevo    ThesisStatus? @relation("EstadoNuevo", fields: [idEstadoNuevo], references: [id])
}

model Company {
  id            Int    @id @default(autoincrement())
  nit           String @unique
  nombre        String
  direccion     String
  telefono      String
  emailContacto String
  estado        String

  practicas Internship[]
}

model Internship {
  id             Int  @id @default(autoincrement())
  idEmpresa      Int
  idTrabajoGrado Int?

  empresa Company @relation(fields: [idEmpresa], references: [id])
  trabajo Thesis? @relation(fields: [idTrabajoGrado], references: [id])
}
