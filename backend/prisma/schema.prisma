generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model tipo_documento {
  id_tipo_documento String    @id @default(cuid())
  documento         String    @db.VarChar(50)
  persona           persona[]

  @@map("TIPO_DOCUMENTO")
}

model persona {
  id_persona            String    @id @default(cuid())
  nombres               String    @db.VarChar(100)
  apellidos             String    @db.VarChar(100)
  id_tipo_doc_identidad String
  num_doc_identidad     String    @unique @db.VarChar(50)
  numero_celular        String    @db.VarChar(20)
  fecha_registro        DateTime  @default(now()) @db.DateTime(0)
  correo_electronico    String    @unique @db.VarChar(100)
  password              String?   @db.VarChar(60)
  token                 String?   @unique @db.VarChar(6)
  confirmed             Boolean   @default(false)
  ultimo_acceso         DateTime? @db.DateTime(0)
  intentos_fallidos     Int       @default(0)
  bloqueado_hasta       DateTime? @db.DateTime(0)
  id_facultad           String?   @db.VarChar(191)
  id_programa_academico String?   @db.VarChar(191)

  tipo_documento     tipo_documento     @relation(fields: [id_tipo_doc_identidad], references: [id_tipo_documento])
  facultad            facultad?          @relation(fields: [id_facultad], references: [id_facultad])
  programa_academico programa_academico? @relation(fields: [id_programa_academico], references: [id_programa])
  actores            actores[]

  @@index([id_tipo_doc_identidad])
  @@index([correo_electronico])
  @@index([token])
  @@index([id_facultad])
  @@index([id_programa_academico])
  @@map("PERSONA")
}

model tipo_rol {
  id_rol         String    @id @default(cuid())
  nombre_rol     String    @db.VarChar(100)
  descripcion    String?   @db.Text
  fecha_creacion DateTime  @default(now()) @db.DateTime(0)
  activo         Boolean   @default(true)
  actores        actores[]

  @@map("TIPO_ROL")
}

model facultad {
  id_facultad        String               @id @default(cuid())
  nombre_facultad    String               @db.VarChar(200)
  codigo_facultad    String               @db.VarChar(20)
  programa_academico programa_academico[]
  persona            persona[]

  @@map("FACULTAD")
}

model nivel_formacion {
  id_nivel               String                   @id @default(cuid())
  nombre_nivel           String                   @db.VarChar(100)
  descripcion            String?                  @db.Text
  programa_academico     programa_academico[]
  opcion_grado_formacion opcion_grado_formacion[]

  @@map("NIVEL_FORMACION")
}

model programa_academico {
  id_programa        String          @id @default(cuid())
  nombre_programa    String          @db.VarChar(200)
  id_nivel_formacion String
  estado             String          @db.VarChar(20)
  id_facultad        String
  nivel_formacion    nivel_formacion @relation(fields: [id_nivel_formacion], references: [id_nivel])
  facultad           facultad        @relation(fields: [id_facultad], references: [id_facultad])
  trabajo_grado      trabajo_grado[]
  persona            persona[]

  @@index([id_nivel_formacion])
  @@index([id_facultad])
  @@map("PROGRAMA_ACADEMICO")
}

model opcion_grado {
  id_opcion_grado        String                   @id @default(cuid())
  nombre_opcion_grado    String                   @db.VarChar(100)
  descripcion            String?                  @db.Text
  estado                 String                   @db.VarChar(20)
  tipo_modalidad         String?                  @db.VarChar(50)
  fecha_creacion         DateTime                 @default(now()) @db.DateTime(0)
  trabajo_grado          trabajo_grado[]
  opcion_grado_formacion opcion_grado_formacion[]

  @@map("OPCION_GRADO")
}

model opcion_grado_formacion {
  id_opcion_grado_formacion String          @id @default(cuid())
  id_opcion_grado           String
  id_nivel_formacion        String
  opcion_grado              opcion_grado    @relation(fields: [id_opcion_grado], references: [id_opcion_grado])
  nivel_formacion           nivel_formacion @relation(fields: [id_nivel_formacion], references: [id_nivel])

  @@index([id_opcion_grado])
  @@index([id_nivel_formacion])
  @@map("opcion_grado_formacion")
}

model empresa {
  id_empresa     String          @id @default(cuid())
  nit_empresa    String          @db.VarChar(50)
  nombre_empresa String          @db.VarChar(200)
  direccion      String?         @db.VarChar(200)
  email          String?         @db.VarChar(100)
  telefono       String?         @db.VarChar(20)
  estado         String          @db.VarChar(20)
  trabajo_grado  trabajo_grado[]

  @@map("EMPRESA")
}

model estado_tg {
  id_estado_tg         String           @id @default(cuid())
  nombre_estado        String           @db.VarChar(100)
  descripcion          String?          @db.Text
  orden                Int
  trabajo_grado        trabajo_grado[]
  seguimiento_anterior seguimiento_tg[] @relation("EstadoAnterior")
  seguimiento_nuevo    seguimiento_tg[] @relation("EstadoNuevo")

  @@map("ESTADO_TG")
}

model trabajo_grado {
  id_trabajo_grado      String             @id @default(cuid())
  titulo_trabajo        String             @db.VarChar(500)
  objetivos             String?            @db.Text
  fecha_fin_estima      DateTime?          @db.Date
  fecha_inicio          DateTime           @db.Date
  resumen               String?            @db.Text
  id_opcion_grado       String
  id_estado_actual      String
  fecha_registro        DateTime           @default(now()) @db.DateTime(0)
  id_empresa_practica   String?
  id_programa_academico String
  opcion_grado          opcion_grado       @relation(fields: [id_opcion_grado], references: [id_opcion_grado])
  estado_tg             estado_tg          @relation(fields: [id_estado_actual], references: [id_estado_tg])
  empresa               empresa?           @relation(fields: [id_empresa_practica], references: [id_empresa])
  programa_academico    programa_academico @relation(fields: [id_programa_academico], references: [id_programa])
  actores               actores[]
  seguimiento_tg        seguimiento_tg[]
  distincion_tg         distincion_tg[]

  @@index([id_opcion_grado])
  @@index([id_estado_actual])
  @@index([id_empresa_practica])
  @@index([id_programa_academico])
  @@map("TRABAJO_GRADO")
}

model actores {
  id_actor         String           @id @default(cuid())
  id_persona       String
  id_trabajo_grado String
  id_tipo_rol      String
  fecha_asignacion DateTime         @default(now())
  fecha_retiro     DateTime?        @db.DateTime(0)
  estado           String           @db.VarChar(20)
  observaciones    String?          @db.Text
  persona          persona          @relation(fields: [id_persona], references: [id_persona])
  trabajo_grado    trabajo_grado    @relation(fields: [id_trabajo_grado], references: [id_trabajo_grado])
  tipo_rol         tipo_rol         @relation(fields: [id_tipo_rol], references: [id_rol])
  seguimiento_tg   seguimiento_tg[]

  @@index([id_persona])
  @@index([id_trabajo_grado])
  @@index([id_tipo_rol])
  @@map("ACTORES")
}

model accion_seg {
  id_accion      String           @id @default(cuid())
  tipo_accion    String           @db.VarChar(100)
  descripcion    String?          @db.Text
  seguimiento_tg seguimiento_tg[]

  @@map("accion_seg")
}

model seguimiento_tg {
  id_seguimiento     String          @id @default(cuid())
  id_trabajo_grado   String
  id_actor           String
  fecha_registro     DateTime        @default(now()) @db.DateTime(0)
  id_accion          String
  resumen            String?         @db.Text
  id_estado_anterior String?
  id_estado_nuevo    String?
  numero_oficio      String?         @db.VarChar(50)
  fecha_oficio       DateTime?       @db.Date
  nombre_documento   String?         @db.VarChar(200)
  tipo_documento     String?         @db.VarChar(50)
  archivo            Bytes?          @db.LongBlob
  calificacion       Decimal?        @db.Decimal(3, 2)
  distincion         String?         @db.VarChar(100)
  fecha              DateTime?       @db.Date
  numero_resolucion  String?         @db.VarChar(50)
  trabajo_grado      trabajo_grado   @relation(fields: [id_trabajo_grado], references: [id_trabajo_grado])
  actores            actores         @relation(fields: [id_actor], references: [id_actor])
  accion_seg         accion_seg      @relation(fields: [id_accion], references: [id_accion])
  estado_anterior    estado_tg?      @relation("EstadoAnterior", fields: [id_estado_anterior], references: [id_estado_tg])
  estado_nuevo       estado_tg?      @relation("EstadoNuevo", fields: [id_estado_nuevo], references: [id_estado_tg])
  distincion_tg      distincion_tg[]

  @@index([id_trabajo_grado])
  @@index([id_actor])
  @@index([id_accion])
  @@index([id_estado_anterior])
  @@index([id_estado_nuevo])
  @@map("SEGUIMIENTO_TG")
}

model distinciones {
  id_distincion String          @id @default(cuid())
  nombre        String          @db.VarChar(100)
  distincion_tg distincion_tg[]

  @@map("DISTINCIONES")
}

model distincion_tg {
  id_distincion_tg  String         @id @default(cuid())
  calificacion      Decimal        @db.Decimal(3, 2)
  fecha             DateTime       @db.Date
  numero_resolucion String         @db.VarChar(50)
  id_distincion     String
  id_trabajo_grado  String
  id_seguimiento    String
  distinciones      distinciones   @relation(fields: [id_distincion], references: [id_distincion])
  trabajo_grado     trabajo_grado  @relation(fields: [id_trabajo_grado], references: [id_trabajo_grado])
  seguimiento_tg    seguimiento_tg @relation(fields: [id_seguimiento], references: [id_seguimiento])

  @@index([id_distincion])
  @@index([id_trabajo_grado])
  @@index([id_seguimiento])
  @@map("DISTINCION_TG")
}

